{"version":3,"file":"../index.js","sources":["index.coffee"],"names":[],"mappings":"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","sourcesContent":["form = document.getElementById 'contactForm'\r\nnameField = document.getElementById 'name'\r\nemailField = document.getElementById 'email'\r\nsubmitBtn = document.getElementById 'submitBtn'\r\nsubmitBtnRegularText = document.getElementById 'submitBtnRegularText'\r\nsubmitBtnSubmittingText = document.getElementById 'submitBtnSubmittingText'\r\n\r\ntoggleClass = (el, cls)->\r\n\tif el.classList.contains cls\r\n\t\tel.classList.remove cls\r\n\telse\r\n\t\tel.classList.add cls\r\n\t\t\r\ntoggleSubmitButtonEnabled = ->\r\n\ttoggleClass(submitBtnRegularText, 'hide')\r\n\ttoggleClass(submitBtnSubmittingText, 'hide')\r\n\ttoggleClass(submitBtn, 'btn-success')\r\n\ttoggleClass(submitBtn, 'btn-light')\r\n\tsubmitBtn.disabled = !submitBtn.disabled\r\n\r\nfieldIsValid = (field)->\r\n\tif field.value.length is 0\r\n\t\tfield.classList.add 'is-invalid'\r\n\t\treturn false\r\n\telse\r\n\t\tfield.classList.remove 'is-invalid'\r\n\t\treturn true\r\n\r\nonSubmit = (event)->\r\n\tnameValid = fieldIsValid(nameField)\r\n\temailValid = fieldIsValid(emailField)\r\n\r\n\tif not nameValid or not emailValid\r\n\t\tif event\r\n\t\t\tevent.preventDefault()\r\n\t\treturn false\r\n\r\n\ttoggleSubmitButtonEnabled()\r\n\r\n\t# prep the entered data\r\n\tfm.contact.email = emailField.value\r\n\tfm.contact.name.set nameField\r\n\r\n\t# Do ajaxy stuff\r\n\tfm.contact.add()\r\n\t\t.then((response)->\r\n\t\t\twindow.location = './thanks.html'\r\n\t\t)\r\n\t\t.catch((error)->\r\n\t\t\tconsole.log('error', error)\r\n\t\t\ttoggleSubmitButtonEnabled()\r\n\t\t\talert \"Error.  See console log in debug mode.\"\r\n\t\t)\r\n\tif event\r\n\t\tevent.preventDefault()\r\n\treturn false\r\n\r\nform.addEventListener 'submit', onSubmit, false\r\napiRoot = '/fmi/data/v1/databases/'\r\nfm =\r\n\thost: 'https://rccbox.fmi-beta.filemaker-cloud.com',\r\n\tapplication: 'FMSP_5_English'\r\n\tbase: ->\r\n\t\tthis.host + apiRoot + this.application + '/'\r\n\tauth:\r\n\t\tusername: 'web_create_contact_only'\r\n\t\tpassword: '12345'\r\n\t\ttoken:\r\n\t\t\tvalue: ''\r\n\t\t\tobtained: null\r\n\t\t\tisExpired: ->\r\n\t\t\t\treturn yes if not this.obtained\r\n\r\n\t\t\t\tkeepsFor = 1000 * 60 * 15\r\n\t\t\t\tnow = new Date()\r\n\t\t\t\tage = now - this.obtained\r\n\r\n\t\t\t\treturn yes if age >= keepsFor\r\n\t\t\t\treturn no\r\n\t\t\tobtain: ->\r\n\t\t\t\tif this.isExpired()\r\n\t\t\t\t\tauthString = btoa([fm.auth.username, fm.auth.password].join(':'))\r\n\t\t\t\t\tconsole.log('created authString for token request', authString)\r\n\t\t\t\t\theaders =\r\n\t\t\t\t\t\t'Authorization': 'Bearer ' + authString\r\n\t\t\t\t\t\t'Content-Type': 'application/json'\r\n\t\t\t\t\theaderObj = new Headers(headers)\r\n\t\t\t\t\tconsole.log('created headers for token request', headers, [...headerObj.entries()])\r\n\t\t\t\t\tp = fetch fm.base() + 'sessions',\r\n\t\t\t\t\t\tmethod: 'POST'\r\n\t\t\t\t\t\theaders: headerObj\r\n\t\t\t\t\t\tbody: '{}'\r\n\t\t\t\t\t\tcache: 'no-cache'\r\n\t\t\t\t\t\tcredentials: 'include'\r\n\t\t\t\t\t.then((response)->\r\n\t\t\t\t\t\tif not response.ok\r\n\t\t\t\t\t\t\tthrow response\r\n\t\t\t\t\t\treturn response.json()\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.then((result) ->\r\n\t\t\t\t\t\tthis.token.obtained = new Date()\r\n\t\t\t\t\t\tthis.token.value = result.response.token\r\n\r\n\t\t\t\t\t\treturn result.response.token\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch((error)->\r\n\t\t\t\t\t\tconsole.log error\r\n\t\t\t\t\t)\r\n\t\t\t\t\treturn p\r\n\t\t\t\telse\r\n\t\t\t\t\treturn Response.Response(\r\n\t\t\t\t\t\tthis.token.value\r\n\t\t\t\t\t)\r\n\t\t\tdestroy: ->\r\n\t\t\t\treturn yes if this.isExpired() \r\n\t\t\t\tp = fetch fm.host + apiRoot + fm.application + '/sessions',\r\n\t\t\t\t\t\tmethod: 'DELETE'\r\n\t\t\t\t\t\theaders: new Headers([\r\n\t\t\t\t\t\t\t['Authorization', 'Bearer ' + this.value ],\r\n\t\t\t\t\t\t\t['Content-Type', 'application/json']\r\n\t\t\t\t\t\t])\r\n\t\t\t\t\t\tbody: '{}'\r\n\t\t\t\t\t\tcache: 'no-cache'\r\n\t\t\t\t\t\tmode: 'no-cors'\r\n\tlayouts:\r\n\t\tcontacts: 'L40_CONTACTS_Data_Entry'\r\n\t\r\n\tcontact:\r\n\t\tname:\r\n\t\t\tfirst: ''\r\n\t\t\tlast: ''\r\n\t\t\tset: (nameField)->\r\n\t\t\t\tnameArr = nameField.value.split ' '\r\n\t\t\t\tif nameArr.lengh > 1\r\n\t\t\t\t\tthis.last = nameArr.splice(-1)\r\n\t\t\t\tthis.first = nameArr.join ' '\r\n\t\temail: ''\r\n\t\tadd: ->\r\n\t\t\tfm.auth.token.obtain()\r\n\t\t\t\t.then((token)->\r\n\t\t\t\t\tpayload = JSON.stringify(\r\n\t\t\t\t\t\t\t\"Name_First\": fm.contact.first\r\n\t\t\t\t\t\t\t\"Name_Last\": fm.contact.last\r\n\t\t\t\t\t\t\t\"Email\": fm.contact.email\r\n\t\t\t\t\t\t, true)\r\n\t\t\t\t\tp = fetch fm.base() + 'layouts/' + fm.layouts.contacts + '/records',\r\n\t\t\t\t\t\t\tmethod: 'POST'\r\n\t\t\t\t\t\t\theaders: new Headers([\r\n\t\t\t\t\t\t\t\t['Authorization', 'Bearer ' + token ],\r\n\t\t\t\t\t\t\t\t['Content-Type', 'application/json']\r\n\t\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\tbody: payload\r\n\t\t\t\t\t\t\tcache: 'no-cache'\r\n\t\t\t\t\t\t\tmode: 'no-cors'\r\n\t\t\t\t\t\r\n\t\t\t\t\tfm.auth.token.destroy()\r\n\r\n\t\t\t\t\treturn p\r\n\t\t\t\t)"]}