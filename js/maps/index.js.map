{"version":3,"file":"../index.js","sources":["index.coffee"],"names":[],"mappings":"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","sourcesContent":["form = document.getElementById 'contactForm'\r\nnameField = document.getElementById 'name'\r\nemailField = document.getElementById 'email'\r\nsubmitBtn = document.getElementById 'submitBtn'\r\nsubmitBtnRegularText = document.getElementById 'submitBtnRegularText'\r\nsubmitBtnSubmittingText = document.getElementById 'submitBtnSubmittingText'\r\n\r\ntoggleClass = (el, cls)->\r\n\tif el.classList.contains cls\r\n\t\tel.classList.remove cls\r\n\telse\r\n\t\tel.classList.add cls\r\n\t\t\r\ntoggleSubmitButtonEnabled = ->\r\n\ttoggleClass(submitBtnRegularText, 'hide')\r\n\ttoggleClass(submitBtnSubmittingText, 'hide')\r\n\ttoggleClass(submitBtn, 'btn-success')\r\n\ttoggleClass(submitBtn, 'btn-light')\r\n\tsubmitBtn.disabled = !submitBtn.disabled\r\n\r\nfieldIsValid = (field)->\r\n\tif field.value.length is 0\r\n\t\tfield.classList.add 'is-invalid'\r\n\t\treturn false\r\n\telse\r\n\t\tfield.classList.remove 'is-invalid'\r\n\t\treturn true\r\n\r\nonSubmit = (event)->\r\n\tnameValid = fieldIsValid(nameField)\r\n\temailValid = fieldIsValid(emailField)\r\n\r\n\tif not nameValid or not emailValid\r\n\t\tif event\r\n\t\t\tevent.preventDefault()\r\n\t\treturn false\r\n\r\n\ttoggleSubmitButtonEnabled()\r\n\r\n\t# Do ajaxy stuff\r\n\t\r\n\r\n\ttoggleSubmitButtonEnabled()\r\n\treturn false;\r\n\r\nform.addEventListener 'submit', onSubmit, false\r\napiRoot = '/fmi/data/v1/databases/'\r\nfm =\r\n\thost: 'https://rccbox.fmi-beta.filemaker-cloud.com',\r\n\tapplication: 'FMSP_5_English'\r\n\tauth:\r\n\t\tusername: ''\r\n\t\tpassword: ''\r\n\t\ttoken:\r\n\t\t\tvalue: ''\r\n\t\t\tobtained: null\r\n\t\t\tisExpired: ->\r\n\t\t\t\treturn yes if not this.obtained\r\n\r\n\t\t\t\tkeepsFor = 1000 * 60 * 15\r\n\t\t\t\tnow = new Date()\r\n\t\t\t\tage = now - this.obtained\r\n\r\n\t\t\t\treturn yes if age >= keepsFor\r\n\t\t\t\treturn no\r\n\t\t\tobtain: ->\r\n\t\t\t\tif this.isExpired()\r\n\t\t\t\t\tp = fetch this.host + apiRoot + this.application + '/sessions',\r\n\t\t\t\t\t\tmethod: 'POST'\r\n\t\t\t\t\t\theaders: new Headers([\r\n\t\t\t\t\t\t\t['Authorization', 'Bearer ' + btoa([fm.auth.username, fm.auth.password].join(':'))],\r\n\t\t\t\t\t\t\t['Content-Type', 'application/json']\r\n\t\t\t\t\t\t])\r\n\t\t\t\t\t\tbody: '{}'\r\n\t\t\t\t\t\tcache: 'no-cache'\r\n\t\t\t\t\t.then((response)->\r\n\t\t\t\t\t\tif not response.ok\r\n\t\t\t\t\t\t\tthrow response\r\n\t\t\t\t\t\treturn response.json()\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.then((result) ->\r\n\t\t\t\t\t\tthis.token.obtained = new Date()\r\n\t\t\t\t\t\tthis.token.value = result.response.token\r\n\r\n\t\t\t\t\t\treturn result.response.token\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.catch((error)->\r\n\t\t\t\t\t\tconsole.log error\r\n\t\t\t\t\t)\r\n\t\t\t\t\treturn p\r\n\t\t\t\telse\r\n\t\t\t\t\treturn Response.Response(\r\n\t\t\t\t\t\tthis.token.value\r\n\t\t\t\t\t)\r\n\t\t\tdestroy: ->\r\n\t\t\t\treturn yes if this.isExpired() \r\n\t\t\t\tp = fetch this.host + apiRoot + this.application + '/sessions',\r\n\t\t\t\t\t\tmethod: 'DELETE'\r\n\t\t\t\t\t\theaders: new Headers([\r\n\t\t\t\t\t\t\t['Authorization', 'Bearer ' + this.value ],\r\n\t\t\t\t\t\t\t['Content-Type', 'application/json']\r\n\t\t\t\t\t\t])\r\n\t\t\t\t\t\tbody: '{}'\r\n\t\t\t\t\t\tcache: 'no-cache'\r\n\tlayouts:\r\n\t\tcontacts: ''\r\n\t\r\n\tcontact:\r\n\t\tadd: ->\r\n\t\t\tp = fetch this.host + apiRoot + this.application + '/sessions',\r\n\taddNewContact: ->\r\n\t\tthis.token.obtain()\r\n\t\t.then((token)->\r\n\t\t\tp = fetch this.host + apiRoot + this.application + '/layouts/' + this.layouts.contacts,\r\n\t\t\t\t\tmethod: 'POST'\r\n\t\t\t\t\theaders: new Headers([\r\n\t\t\t\t\t\t['Authorization', 'Bearer ' + token ],\r\n\t\t\t\t\t\t['Content-Type', 'application/json']\r\n\t\t\t\t\t])\r\n\t\t\t\t\tbody: '{}'\r\n\t\t\t\t\tcache: 'no-cache'\r\n\t\t)\r\n\t\t\t"]}